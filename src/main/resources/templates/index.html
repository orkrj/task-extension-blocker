<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒŒì¼ í™•ì¥ì ì°¨ë‹¨ ê³¼ì œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      position: relative;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
    }

    h1 {
      color: #333;
      font-size: 2.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      flex: 1;
    }

    .creator-field {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .creator-field:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .creator-field::before {
      content: 'ğŸ‘¨â€ğŸ’»';
      font-size: 1.2rem;
    }

    .creator-field::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .section {
      margin-bottom: 40px;
      padding: 30px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .section h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section h2::before {
      content: '';
      width: 4px;
      height: 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 2px;
    }

    .custom-count {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #e8ecff;
      color: #667eea;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid rgba(102, 126, 234, 0.2);
      margin-left: auto;
    }

    .custom-count-icon {
      font-size: 1rem;
    }

    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: #f8f9ff;
      border-radius: 10px;
      transition: all 0.3s ease;
      cursor: pointer;
      border: 2px solid transparent;
      user-select: none;
    }

    .checkbox-item:hover {
      background: #e8ecff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .checkbox-item.checked {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-color: #667eea;
    }

    .checkbox-item input[type="checkbox"] {
      margin-right: 8px;
      width: 18px;
      height: 18px;
      accent-color: #667eea;
    }

    .checkbox-item.checked input[type="checkbox"] {
      accent-color: white;
    }

    .custom-form {
      display: flex;
      gap: 15px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .form-group {
      flex: 1;
      min-width: 200px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f8f9ff;
      height: 48px;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    .btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
      min-width: 100px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .custom-list {
      margin-top: 25px;
    }

    .custom-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background: #f8f9ff;
      border-radius: 10px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .custom-item:hover {
      background: #e8ecff;
      transform: translateX(5px);
    }

    .custom-item .extension {
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }

    .delete-btn {
      width: 32px;
      height: 32px;
      background: #ff4757;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s ease;
    }

    .delete-btn:hover {
      background: #ff3742;
      transform: scale(1.1);
    }

    .empty-state {
      text-align: center;
      color: #666;
      font-style: italic;
      padding: 30px;
      background: #f8f9ff;
      border-radius: 10px;
      border: 2px dashed #ddd;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .error-message {
      background: #ffe6e6;
      color: #d63031;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #fab1a0;
      display: none;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid #c3e6cb;
      display: none;
    }

    .upload-form {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .file-input-wrapper {
      flex: 1;
      min-width: 300px;
    }

    .file-input-container {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .file-input {
      display: none;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: #f8f9ff;
      border: 2px dashed #667eea;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      color: #667eea;
      height: 48px;
      box-sizing: border-box;
      flex: 1;
    }

    .file-input-label:hover {
      background: #e8ecff;
      border-color: #764ba2;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    .file-input-label.has-file {
      border-style: solid;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .file-icon {
      font-size: 1.5rem;
    }

    .file-text {
      font-size: 16px;
    }

    .file-name {
      font-size: 14px;
      color: #666;
      padding-left: 4px;
    }

    .file-name.selected {
      color: #667eea;
      font-weight: 500;
    }

    .upload-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 160px;
      justify-content: center;
      align-self: flex-start;
    }

    .upload-icon {
      font-size: 1.2rem;
    }

    .upload-description {
      color: #666;
      margin-bottom: 20px;
      padding: 16px;
      background: #f8f9ff;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .upload-info {
      margin-top: 20px;
      padding: 16px;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #856404;
      font-size: 14px;
    }

    .info-icon {
      font-size: 16px;
    }

    .upload-status {
      margin-top: 15px;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 500;
      display: none;
    }

    .upload-status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .global-message {
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 500px;
      width: auto;
      min-width: 300px;
      padding: 16px 20px;
      border-radius: 12px;
      font-weight: 500;
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .global-message.show {
      top: 20px;
    }

    .global-message.success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }

    .global-message.error {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }

    .global-message-icon {
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .global-message-close {
      margin-left: auto;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s ease;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .global-message-close:hover {
      opacity: 1;
    }

    .upload-status.blocked {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    @media (max-width: 768px) {
      .global-message {
        top: -100px;
        left: 10px;
        right: 10px;
        max-width: none;
        min-width: auto;
        width: calc(100% - 20px);
        transform: none;
      }

      .global-message.show {
        top: 10px;
      }

      .header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }

      h1 {
        font-size: 2rem;
      }

      .creator-field {
        align-self: stretch;
        justify-content: center;
      }

      .upload-form {
        flex-direction: column;
        align-items: stretch;
      }

      .file-input-wrapper {
        min-width: auto;
      }
    }
  </style>
</head>
<body>
<div class="container fade-in">
  <div class="header">
    <h1>ğŸ›¡ï¸ íŒŒì¼ í™•ì¥ì ì°¨ë‹¨ê¸°</h1>
    <div class="creator-field" onclick="window.open('https://github.com/orkrj/task-extension-blocker', '_blank')">ì •ìš°ì¤€</div>
  </div>

  <!-- ê³ ì • í™•ì¥ì ì„¹ì…˜ -->
  <div class="section">
    <h2>ê³ ì • í™•ì¥ì</h2>
    <div class="checkbox-grid" id="fixedExtensions">
    </div>
  </div>

  <!-- ì»¤ìŠ¤í…€ í™•ì¥ì ì„¹ì…˜ -->
  <div class="section">
    <h2>
      <span>ì»¤ìŠ¤í…€ í™•ì¥ì</span>
      <div class="custom-count" id="customCount">
        <span class="custom-count-icon">ğŸ“Š</span>
        <span id="customCountText">0/0ê°œ</span>
      </div>
    </h2>
    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>

    <form class="custom-form" onsubmit="addCustomExtension(event)">
      <div class="form-group">
        <label for="customExtension">í™•ì¥ì ì…ë ¥ (ìµœëŒ€ 20ì)</label>
        <input type="text"
               id="customExtension"
               name="extension"
               maxlength="20"
               placeholder="ì˜ˆ: pdf, docx"
               pattern="[a-zA-Z0-9]+"
               title="ì˜ë¬¸ìì™€ ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤"
               required>
      </div>
      <button type="submit" class="btn">ì¶”ê°€</button>
    </form>

    <div class="custom-list">
      <div id="customBlockersList">
        <div class="empty-state">ë“±ë¡ëœ ì»¤ìŠ¤í…€ í™•ì¥ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <!-- íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
  <div class="section">
    <h2>íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    <div class="upload-description">
      ì„¤ì •í•œ í™•ì¥ì ì°¨ë‹¨ ê·œì¹™ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”. ì°¨ë‹¨ëœ í™•ì¥ìì˜ íŒŒì¼ì€ ì—…ë¡œë“œê°€ ê±°ë¶€ë©ë‹ˆë‹¤.
    </div>

    <div class="error-message" id="uploadErrorMessage"></div>
    <div class="success-message" id="uploadSuccessMessage"></div>

    <form class="upload-form" onsubmit="uploadFile(event)">
      <div class="file-input-wrapper">
        <div class="file-input-container">
          <input type="file"
                 id="fileInput"
                 name="file"
                 class="file-input"
                 onchange="updateFileName(this)"
                 required>
          <label for="fileInput" class="file-input-label">
            <span class="file-icon">ğŸ“</span>
            <span class="file-text">íŒŒì¼ ì„ íƒ</span>
          </label>
        </div>
        <div class="file-name" id="fileName">ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
      <button type="submit" class="btn upload-btn">
        <span class="upload-icon">â¬†ï¸</span>
        ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
      </button>
    </form>

    <div class="upload-info">
      <div class="info-item">
        <span class="info-icon">â„¹ï¸</span>
        <span>ì‹¤ì œë¡œ íŒŒì¼ì´ ì €ì¥ë˜ì§€ëŠ” ì•Šìœ¼ë©°, í™•ì¥ì ê²€ì¦ë§Œ ìˆ˜í–‰ë©ë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>
</div>

<!-- ê¸€ë¡œë²Œ ë©”ì‹œì§€ íŒì—… -->
<div class="global-message" id="globalMessage">
  <span class="global-message-icon" id="globalMessageIcon"></span>
  <span class="global-message-text" id="globalMessageText"></span>
  <button class="global-message-close" onclick="hideGlobalMessage()">Ã—</button>
</div>

<script>
  let allBlockers = [];

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  document.addEventListener('DOMContentLoaded', async function() {
    await loadFixedExtensions();
    await loadCustomExtensions();
    await loadCustomCount();
  });

  // ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ë¡œë“œ
  async function loadCustomCount() {
    try {
      const response = await fetch('/blockers/custom/count');
      if (!response.ok) {
        throw new Error('ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ë¡œë“œ ì‹¤íŒ¨');
      }

      const data = await response.json();
      updateCustomCount(data.count, data.limit);
    } catch (error) {
      console.error('ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ë¡œë“œ ì˜¤ë¥˜:', error);
      // ê°œìˆ˜ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ìœ ì§€
      updateCustomCount(0, 0);
    }
  }

  // ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ì—…ë°ì´íŠ¸
  function updateCustomCount(count, limit) {
    const countText = document.getElementById('customCountText');
    countText.textContent = `${count}/${limit}ê°œ`;
  }

  // ê¸€ë¡œë²Œ ë©”ì‹œì§€ í‘œì‹œ
  function showGlobalMessage(message, type) {
    const messageDiv = document.getElementById('globalMessage');
    const iconDiv = document.getElementById('globalMessageIcon');
    const textDiv = document.getElementById('globalMessageText');

    // ì´ì „ í´ë˜ìŠ¤ ì œê±°
    messageDiv.classList.remove('success', 'error', 'show');

    // ì•„ì´ì½˜ê³¼ ë©”ì‹œì§€ ì„¤ì •
    if (type === 'success') {
      iconDiv.textContent = 'âœ…';
      messageDiv.classList.add('success');
    } else {
      iconDiv.textContent = 'âŒ';
      messageDiv.classList.add('error');
    }

    textDiv.textContent = message;

    // ë©”ì‹œì§€ í‘œì‹œ
    setTimeout(() => messageDiv.classList.add('show'), 10);

    // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    setTimeout(() => {
      hideGlobalMessage();
    }, 5000);
  }

  // ê¸€ë¡œë²Œ ë©”ì‹œì§€ ìˆ¨ê¹€
  function hideGlobalMessage() {
    const messageDiv = document.getElementById('globalMessage');
    messageDiv.classList.remove('show');
  }

  // ì²´í¬ë°•ìŠ¤ ì•„ì´í…œ í´ë¦­ ì²˜ë¦¬
  function toggleCheckboxItem(item, extension) {
    const checkbox = item.querySelector('input[type="checkbox"]');
    checkbox.checked = !checkbox.checked;

    // ì²´í¬ë°•ìŠ¤ change ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
    const event = new Event('change', { bubbles: true });
    checkbox.dispatchEvent(event);
  }

  // ê³ ì • í™•ì¥ì ë¡œë“œ
  async function loadFixedExtensions() {
    try {
      const response = await fetch('/blockers/fixed');
      if (!response.ok) {
        throw new Error('ê³ ì • í™•ì¥ì ë¡œë“œ ì‹¤íŒ¨');
      }

      const fixedBlockers = await response.json();
      renderFixedExtensions(fixedBlockers);
    } catch (error) {
      console.error('ê³ ì • í™•ì¥ì ë¡œë“œ ì˜¤ë¥˜:', error);
      showGlobalMessage('ê³ ì • í™•ì¥ì ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  }

  // ê³ ì • í™•ì¥ì ë Œë”ë§
  function renderFixedExtensions(fixedBlockers) {
    const container = document.getElementById('fixedExtensions');

    container.innerHTML = fixedBlockers.map(blocker => `
      <div class="checkbox-item ${blocker.enabled ? 'checked' : ''}" id="fixed-${blocker.extension}" onclick="toggleCheckboxItem(this, '${blocker.extension}')">
        <input type="checkbox"
               id="checkbox-${blocker.extension}"
               ${blocker.enabled ? 'checked' : ''}
               data-extension="${blocker.extension}"
               onchange="toggleFixedExtension(this)"
               onclick="event.stopPropagation()">
        <label for="checkbox-${blocker.extension}">${blocker.extension}</label>
      </div>
    `).join('');
  }

  // ì»¤ìŠ¤í…€ í™•ì¥ì ë¡œë“œ
  async function loadCustomExtensions() {
    try {
      const response = await fetch('/blockers');
      if (!response.ok) {
        throw new Error('í™•ì¥ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
      }

      const blockers = await response.json();
      const customBlockers = blockers.filter(blocker =>
          blocker.type === 'CUSTOM' && blocker.enabled
      );

      renderCustomExtensions(customBlockers);
    } catch (error) {
      console.error('ì»¤ìŠ¤í…€ í™•ì¥ì ë¡œë“œ ì˜¤ë¥˜:', error);
      showGlobalMessage('ì»¤ìŠ¤í…€ í™•ì¥ì ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  }

  // ì»¤ìŠ¤í…€ í™•ì¥ì ë Œë”ë§
  function renderCustomExtensions(customBlockers) {
    const listContainer = document.getElementById('customBlockersList');

    if (customBlockers.length === 0) {
      listContainer.innerHTML = '<div class="empty-state">ë“±ë¡ëœ ì»¤ìŠ¤í…€ í™•ì¥ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    } else {
      listContainer.innerHTML = customBlockers.map(blocker => `
        <div class="custom-item fade-in">
          <span class="extension">${blocker.extension}</span>
          <button class="delete-btn" onclick="deleteCustomExtension('${blocker.extension}')">Ã—</button>
        </div>
      `).join('');
    }
  }

  // ê³ ì • í™•ì¥ì í† ê¸€
  async function toggleFixedExtension(checkbox) {
    const extension = checkbox.dataset.extension;
    const isChecked = checkbox.checked;
    const item = checkbox.parentElement;

    try {
      item.classList.add('loading');

      if (isChecked) {
        // ìƒì„± API í˜¸ì¶œ
        const response = await fetch('/blockers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            extension: extension
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText);
        }

        const result = await response.json();
        if (result.enabled) {
          item.classList.add('checked');
          showGlobalMessage(`'${extension}' ê³ ì • í™•ì¥ìê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }
      } else {
        // ì‚­ì œ API í˜¸ì¶œ
        const response = await fetch(`/blockers/${extension}`, {
          method: 'PATCH'
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText);
        }

        item.classList.remove('checked');
        showGlobalMessage(`'${extension}' ê³ ì • í™•ì¥ìê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
      }
    } catch (error) {
      console.error('API ì˜¤ë¥˜:', error);
      checkbox.checked = !isChecked; // ì²´í¬ë°•ìŠ¤ ì›ìƒë³µêµ¬
      if (isChecked) {
        item.classList.remove('checked');
      } else {
        item.classList.add('checked');
      }
      showGlobalMessage(error.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    } finally {
      item.classList.remove('loading');
    }
  }

  // ì»¤ìŠ¤í…€ í™•ì¥ì ì¶”ê°€
  async function addCustomExtension(event) {
    event.preventDefault();

    const form = event.target;
    const extensionInput = form.extension;
    const extension = extensionInput.value.trim().toLowerCase();

    if (!extension) {
      showGlobalMessage('í™•ì¥ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
      return;
    }

    try {
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading-spinner"></span>ì¶”ê°€ ì¤‘...';

      const response = await fetch('/blockers', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          extension: extension
        })
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(errorText);
      }

      const result = await response.json();
      extensionInput.value = '';

      // ê³ ì • í™•ì¥ìì¸ì§€ í™•ì¸í•˜ê³  UI ì—…ë°ì´íŠ¸
      if (result.type === 'FIXED') {
        await updateFixedExtensionUI(extension, true);
        showGlobalMessage(`'${extension}' ê³ ì • í™•ì¥ìê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
      } else {
        await loadCustomExtensions();
        await loadCustomCount(); // ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ì—…ë°ì´íŠ¸
        showGlobalMessage(`'${extension}' ì»¤ìŠ¤í…€ í™•ì¥ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
      }
    } catch (error) {
      console.error('API ì˜¤ë¥˜:', error);
      showGlobalMessage(error.message || 'ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    } finally {
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'ì¶”ê°€';
    }
  }

  // ì»¤ìŠ¤í…€ í™•ì¥ì ì‚­ì œ
  async function deleteCustomExtension(extension) {
    if (!confirm(`'${extension}' í™•ì¥ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      return;
    }

    try {
      const response = await fetch(`/blockers/${extension}`, {
        method: 'PATCH'
      });

      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(errorText);
      }

      await loadCustomExtensions();
      await loadCustomCount(); // ì»¤ìŠ¤í…€ í™•ì¥ì ê°œìˆ˜ ì—…ë°ì´íŠ¸
      showGlobalMessage(`'${extension}' ì»¤ìŠ¤í…€ í™•ì¥ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
    } catch (error) {
      console.error('API ì˜¤ë¥˜:', error);
      showGlobalMessage(error.message || 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
    }
  }

  // ê³ ì • í™•ì¥ì UI ì—…ë°ì´íŠ¸ (ì»¤ìŠ¤í…€ì—ì„œ ê³ ì • í™•ì¥ì í™œì„±í™”í•  ë•Œ ì‚¬ìš©)
  async function updateFixedExtensionUI(extension, isEnabled) {
    const fixedItem = document.getElementById(`fixed-${extension}`);
    const checkbox = document.getElementById(`checkbox-${extension}`);

    if (fixedItem && checkbox) {
      checkbox.checked = isEnabled;
      if (isEnabled) {
        fixedItem.classList.add('checked');
      } else {
        fixedItem.classList.remove('checked');
      }
    }
  }

  // íŒŒì¼ëª… ì—…ë°ì´íŠ¸
  function updateFileName(input) {
    const fileName = document.getElementById('fileName');
    const label = input.nextElementSibling;

    if (input.files.length > 0) {
      const file = input.files[0];
      fileName.textContent = file.name;
      fileName.classList.add('selected');
      label.classList.add('has-file');

      // íŒŒì¼ í™•ì¥ì ì¶”ì¶œ ë° ë¯¸ë¦¬ í™•ì¸
      const extension = file.name.split('.').pop().toLowerCase();
      checkExtensionPreview(extension);
    } else {
      fileName.textContent = 'ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤';
      fileName.classList.remove('selected');
      label.classList.remove('has-file');
    }
  }

  // í™•ì¥ì ë¯¸ë¦¬ í™•ì¸ (ì„ íƒì )
  async function checkExtensionPreview(extension) {
    try {
      // blockers ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ ì°¨ë‹¨ëœ í™•ì¥ìì¸ì§€ í™•ì¸
      const response = await fetch('/blockers');
      const blockers = await response.json();
      const isBlocked = blockers.some(blocker =>
          blocker.extension === extension && blocker.enabled
      );

      const fileName = document.getElementById('fileName');
      if (isBlocked) {
        fileName.style.color = '#dc3545';
        fileName.innerHTML += ' <span style="font-weight: bold;">(ì°¨ë‹¨ëœ í™•ì¥ì)</span>';
      }
    } catch (error) {
      // ë¯¸ë¦¬ë³´ê¸° í™•ì¸ ì‹¤íŒ¨ëŠ” ë¬´ì‹œ
      console.log('í™•ì¥ì ë¯¸ë¦¬ë³´ê¸° í™•ì¸ ì‹¤íŒ¨:', error);
    }
  }

  // íŒŒì¼ ì—…ë¡œë“œ
  async function uploadFile(event) {
    event.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];

    if (!file) {
      showUploadMessage('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
      return;
    }

    // í™•ì¥ì ì¶”ì¶œ
    const extension = file.name.split('.').pop().toLowerCase();

    try {
      const submitBtn = event.target.querySelector('button[type="submit"]');
      const originalHTML = submitBtn.innerHTML;
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="loading-spinner"></span>ì—…ë¡œë“œ ì¤‘...';

      // ë¨¼ì € í™•ì¥ìê°€ ì°¨ë‹¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
      const blockersResponse = await fetch('/blockers');
      const blockers = await blockersResponse.json();
      const isBlocked = blockers.some(blocker =>
          blocker.extension === extension && blocker.enabled
      );

      if (isBlocked) {
        showUploadMessage(
            `'${extension}' í™•ì¥ìëŠ” ì°¨ë‹¨ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
            'error'
        );
        return;
      }

      // íŒŒì¼ ì—…ë¡œë“œ API í˜¸ì¶œ
      const formData = new FormData();
      formData.append('file', file);

      const uploadResponse = await fetch('/uploads', {
        method: 'POST',
        body: formData
      });

      if (uploadResponse.status === 201) {
        showUploadMessage(
            `'${file.name}' íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤! (í™•ì¥ì: ${extension})`,
            'success'
        );
        // í¼ ë¦¬ì…‹
        fileInput.value = '';
        updateFileName(fileInput);
      } else {
        throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨');
      }
    } catch (error) {
      console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
      showUploadMessage(
          error.message || 'ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
          'error'
      );
    } finally {
      const submitBtn = event.target.querySelector('button[type="submit"]');
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<span class="upload-icon">â¬†ï¸</span>ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸';
    }
  }

  // ì—…ë¡œë“œ ë©”ì‹œì§€ í‘œì‹œ
  function showUploadMessage(message, type) {
    const errorDiv = document.getElementById('uploadErrorMessage');
    const successDiv = document.getElementById('uploadSuccessMessage');

    // ì´ì „ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';

    if (type === 'error') {
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => errorDiv.style.display = 'none', 5000);
    } else {
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      setTimeout(() => successDiv.style.display = 'none', 4000);
    }
  }

  // ë©”ì‹œì§€ í‘œì‹œ
  function showMessage(message, type) {
    const errorDiv = document.getElementById('errorMessage');
    const successDiv = document.getElementById('successMessage');

    // ì´ì „ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';

    if (type === 'error') {
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => errorDiv.style.display = 'none', 5000);
    } else {
      successDiv.textContent = message;
      successDiv.style.display = 'block';
      setTimeout(() => successDiv.style.display = 'none', 3000);
    }
  }
</script>
</body>
</html>